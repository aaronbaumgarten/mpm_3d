//
// Created by aaron on 8/26/16.
// body.hpp
//

#ifndef MPM_3D_BODY_HPP
#define MPM_3D_BODY_HPP

#include <vector>
#include <Eigen/Sparse>
#include <Eigen/StdVector>

#include "particle.hpp"
#include "node.hpp"
#include "element.hpp"
#include "material.hpp"

class Body{
public:
    //material
    Material material;

    //nodes
    size_t n;

    //particles
    size_t p;

    //elements
    size_t e;

    //body id
    size_t id;

    //***** objects *****
    std::vector<Particle> particles;
    std::vector<Node> nodes;
    std::vector<Element> elements;

    //***** nodal vectors *****
    //mass
    std::vector<double> node_m;

    //position
    std::vector<double> node_x;
    std::vector<double> node_y;
    std::vector<double> node_z;

    //displacement
    std::vector<double> node_ux;
    std::vector<double> node_uy;
    std::vector<double> node_uz;

    //velocity
    std::vector<double> node_x_t;
    std::vector<double> node_y_t;
    std::vector<double> node_z_t;

    //velocity difference
    std::vector<double> node_diff_x_t;
    std::vector<double> node_diff_y_t;
    std::vector<double> node_diff_z_t;

    //momentum
    std::vector<double> node_mx_t;
    std::vector<double> node_my_t;
    std::vector<double> node_mz_t;

    //force
    std::vector<double> node_fx;
    std::vector<double> node_fy;
    std::vector<double> node_fz;

    //density
    std::vector<double> node_rho;

    //body contact resolution
    std::vector<double> node_contact_mx_t;
    std::vector<double> node_contact_my_t;
    std::vector<double> node_contact_mz_t;

    std::vector<double> node_contact_x_t;
    std::vector<double> node_contact_y_t;
    std::vector<double> node_contact_z_t;

    std::vector<double> node_contact_fx;
    std::vector<double> node_contact_fy;
    std::vector<double> node_contact_fz;

    std::vector<double> node_real_contact_fx;
    std::vector<double> node_real_contact_fy;
    std::vector<double> node_real_contact_fz;

    std::vector<double> node_contact_normal_x;
    std::vector<double> node_contact_normal_y;
    std::vector<double> node_contact_normal_z;

    //***** particle values *****
    //position
    std::vector<double> particle_x;
    std::vector<double> particle_y;
    std::vector<double> particle_z;

    //volume
    std::vector<double> particle_v;
    std::vector<double> particle_v0;
    std::vector<double> particle_v_averaging;

    //half side length
    std::vector<double> particle_a;

    //mass
    std::vector<double> particle_m;

    //velocity
    std::vector<double> particle_x_t;
    std::vector<double> particle_y_t;
    std::vector<double> particle_z_t;

    //body forces
    std::vector<double> particle_bx;
    std::vector<double> particle_by;
    std::vector<double> particle_bz;

    //displacements
    std::vector<double> particle_ux;
    std::vector<double> particle_uy;
    std::vector<double> particle_uz;

    //active
    std::vector<int> particle_active;

    //S and gradS triplets
    std::vector<Eigen::Triplet<double>,Eigen::aligned_allocator<Eigen::Triplet<double>>> PhiTriplets;
    std::vector<Eigen::Triplet<double>,Eigen::aligned_allocator<Eigen::Triplet<double>>> gradPhiXTriplets;
    std::vector<Eigen::Triplet<double>,Eigen::aligned_allocator<Eigen::Triplet<double>>> gradPhiYTriplets;
    std::vector<Eigen::Triplet<double>,Eigen::aligned_allocator<Eigen::Triplet<double>>> gradPhiZTriplets;

    //Phi and gradPhi
    Eigen::SparseMatrix<double> Phi;
    Eigen::SparseMatrix<double> gradPhiX;
    Eigen::SparseMatrix<double> gradPhiY;
    Eigen::SparseMatrix<double> gradPhiZ;

    //construcors
    Body(size_t,size_t,size_t,size_t);
    //destructors
    //~Body();

    //functions
    void addParticle(double,double,double,double,double,double,double,double,size_t);
    void addNode(double,double,double,size_t);
    void addElement(size_t[8],size_t);
    void defineMaterial(double*,int*);
};

#endif //MPM_3D_BODY_HPP
